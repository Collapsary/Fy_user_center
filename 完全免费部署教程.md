# 🆓 完全免费部署教程 - 用户管理系统

## 🎯 免费部署方案概览

### 方案一：Docker + 免费云服务器（推荐）✅
- **服务器**：Oracle Cloud（永久免费）
- **数据库**：Docker MySQL
- **后端**：Docker Spring Boot
- **前端**：Vercel（免费）

### 方案二：宝塔面板 + 免费云服务器
- **服务器**：Oracle Cloud（永久免费）
- **面板**：宝塔Linux面板（免费版）
- **数据库**：MySQL
- **后端**：Java应用
- **前端**：Vercel（免费）

### 方案三：Railway + Vercel（最简单）
- **后端**：Railway（免费额度）
- **数据库**：Railway MySQL（免费额度）
- **前端**：Vercel（免费）

## 🚀 方案一：Docker部署（推荐）

### 第一步：申请Oracle Cloud免费服务器

#### 1.1 注册Oracle Cloud
1. 访问 [Oracle Cloud](https://www.oracle.com/cloud/free/)
2. 点击 **"Start for free"**
3. 填写注册信息
4. 验证邮箱和手机号
5. 等待审核通过（通常1-2天）

#### 1.2 创建免费实例
1. 登录Oracle Cloud控制台
2. 点击 **"Create a VM instance"**
3. 选择配置：
   - **Image**: Oracle Linux 8
   - **Shape**: VM.Standard.E2.1.Micro（永久免费）
   - **SSH Key**: 生成或上传SSH密钥
4. 点击 **"Create"**
5. 等待实例创建完成

#### 1.3 配置安全组
1. 进入实例详情
2. 点击 **"Security Lists"**
3. 添加入站规则：
   - **Source**: 0.0.0.0/0
   - **IP Protocol**: TCP
   - **Destination Port Range**: 22, 80, 443, 8080, 3306

### 第二步：安装Docker环境

#### 2.1 连接服务器
```bash
ssh opc@your-server-ip
```

#### 2.2 安装Docker
```bash
# 更新系统
sudo yum update -y

# 安装Docker
sudo yum install -y docker

# 启动Docker服务
sudo systemctl start docker
sudo systemctl enable docker

# 将当前用户添加到docker组
sudo usermod -aG docker opc

# 重新登录或执行
newgrp docker

# 验证安装
docker --version
```

#### 2.3 安装Docker Compose
```bash
# 下载Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 添加执行权限
sudo chmod +x /usr/local/bin/docker-compose

# 验证安装
docker-compose --version
```

### 第三步：创建Docker配置文件

#### 3.1 创建项目目录
```bash
mkdir -p /home/opc/user-center
cd /home/opc/user-center
```

#### 3.2 创建Docker Compose文件
```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: user-center-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root123456
      MYSQL_DATABASE: user_center
      MYSQL_USER: usercenter
      MYSQL_PASSWORD: user123456
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    command: --default-authentication-plugin=mysql_native_password

  backend:
    image: openjdk:8-jre-alpine
    container_name: user-center-backend
    restart: always
    ports:
      - "8080:8080"
    volumes:
      - ./app.jar:/app/app.jar
      - ./application-prod.yml:/app/application-prod.yml
    depends_on:
      - mysql
    command: java -jar /app/app.jar --spring.config.location=/app/application-prod.yml

volumes:
  mysql_data:
```

#### 3.3 创建数据库初始化脚本
```sql
-- init.sql
CREATE DATABASE IF NOT EXISTS user_center CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

USE user_center;

CREATE TABLE IF NOT EXISTS user (
    id bigint NOT NULL AUTO_INCREMENT COMMENT 'id',
    username varchar(256) DEFAULT NULL COMMENT '用户昵称',
    userAccount varchar(256) NOT NULL COMMENT '账号',
    avatarUrl varchar(1024) DEFAULT NULL COMMENT '用户头像',
    gender tinyint DEFAULT NULL COMMENT '性别',
    userPassword varchar(512) NOT NULL COMMENT '密码',
    phone varchar(128) DEFAULT NULL COMMENT '电话',
    email varchar(512) DEFAULT NULL COMMENT '邮箱',
    userStatus int NOT NULL DEFAULT '0' COMMENT '状态 0 - 正常',
    createTime datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updateTime datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    isDelete tinyint NOT NULL DEFAULT '0' COMMENT '是否删除',
    userRole int NOT NULL DEFAULT '0' COMMENT '用户角色 0 - 普通用户 1 - 管理员',
    planetCode varchar(512) DEFAULT NULL COMMENT '星球编号',
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='用户';
```

#### 3.4 创建生产环境配置
```yaml
# application-prod.yml
server:
  port: 8080

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://mysql:3306/user_center?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: usercenter
    password: user123456
  profiles:
    active: prod

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      logic-delete-field: isDelete
      logic-delete-value: 1
      logic-not-delete-value: 0

logging:
  level:
    com.fy.usercenter: INFO
    org.springframework: WARN
```

### 第四步：构建和部署

#### 4.1 构建后端应用
```bash
# 在本地执行
cd back/FioonYang-center
mvn clean package -DskipTests

# 上传jar包到服务器
scp target/*.jar opc@your-server-ip:/home/opc/user-center/app.jar
```

#### 4.2 上传配置文件
```bash
# 上传配置文件
scp application-prod.yml opc@your-server-ip:/home/opc/user-center/
scp init.sql opc@your-server-ip:/home/opc/user-center/
scp docker-compose.yml opc@your-server-ip:/home/opc/user-center/
```

#### 4.3 启动服务
```bash
# 在服务器上执行
cd /home/opc/user-center
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f
```

### 第五步：部署前端到Vercel

#### 5.1 修改前端配置
```typescript
// front/user-center-frontend-master/src/plugins/globalRequest.ts
const request = extend({
  credentials: 'include',
  prefix: process.env.NODE_ENV === 'production' 
    ? process.env.REACT_APP_API_URL || 'http://your-server-ip:8080' 
    : 'http://localhost:8080',
  timeout: 10000,
});
```

#### 5.2 部署到Vercel
1. 访问 [Vercel](https://vercel.com/)
2. 连接Gitee仓库
3. 选择前端目录
4. 配置环境变量：
   ```
   NODE_ENV=production
   REACT_APP_API_URL=http://your-server-ip:8080
   ```

## 🚀 方案二：宝塔面板部署

### 第一步：安装宝塔面板

#### 1.1 安装宝塔Linux面板
```bash
# 在Oracle Cloud服务器上执行
wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec
```

#### 1.2 配置宝塔面板
1. 安装完成后，记录面板地址和账号密码
2. 在浏览器中访问面板地址
3. 登录面板

#### 1.3 安装必要软件
在宝塔面板中安装：
- **Nginx** 1.20
- **MySQL** 8.0
- **Java** 8
- **Maven** 3.8

### 第二步：配置数据库

#### 2.1 创建数据库
1. 在宝塔面板点击 **"数据库"**
2. 点击 **"添加数据库"**
3. 设置：
   - **数据库名**: user_center
   - **用户名**: usercenter
   - **密码**: user123456
4. 点击 **"提交"**

#### 2.2 导入数据库结构
1. 点击数据库后的 **"管理"**
2. 进入phpMyAdmin
3. 导入数据库结构（使用上面的init.sql）

### 第三步：部署后端

#### 3.1 上传代码
1. 在宝塔面板点击 **"文件"**
2. 进入 `/www/wwwroot/` 目录
3. 创建 `user-center` 目录
4. 上传后端代码

#### 3.2 构建应用
```bash
# 在宝塔终端中执行
cd /www/wwwroot/user-center/back/FioonYang-center
mvn clean package -DskipTests
```

#### 3.3 配置启动脚本
```bash
# 创建启动脚本
cat > /www/wwwroot/user-center/start.sh << EOF
#!/bin/bash
cd /www/wwwroot/user-center/back/FioonYang-center
java -jar target/*.jar --spring.profiles.active=prod
EOF

chmod +x /www/wwwroot/user-center/start.sh
```

#### 3.4 配置PM2管理
1. 在宝塔面板安装 **PM2管理器**
2. 添加新项目：
   - **项目名称**: user-center-backend
   - **运行目录**: /www/wwwroot/user-center/back/FioonYang-center
   - **启动文件**: start.sh
   - **端口**: 8080

### 第四步：配置Nginx反向代理

#### 4.1 创建Nginx配置
```nginx
# /www/server/panel/vhost/nginx/user-center.conf
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### 4.2 重启Nginx
```bash
nginx -s reload
```

## 🚀 方案三：Railway部署（最简单）

### 第一步：注册Railway
1. 访问 [Railway](https://railway.app/)
2. 使用GitHub账号登录
3. 连接GitHub仓库

### 第二步：部署后端
1. 在Railway创建新项目
2. 选择 **"Deploy from GitHub repo"**
3. 选择您的仓库
4. 设置构建目录：`back/FioonYang-center`
5. 配置环境变量：
   ```
   SPRING_PROFILES_ACTIVE=prod
   MYSQL_HOST=mysql
   MYSQL_PORT=3306
   MYSQL_DATABASE=user_center
   MYSQL_USER=usercenter
   MYSQL_PASSWORD=user123456
   ```

### 第三步：部署数据库
1. 在Railway添加MySQL服务
2. 配置数据库连接
3. 导入数据库结构

### 第四步：部署前端
1. 使用Vercel部署前端
2. 配置API地址指向Railway后端

## 💰 费用对比

| 方案 | 服务器 | 数据库 | 前端 | 总费用 |
|------|--------|--------|------|--------|
| Docker + Oracle | 免费 | 免费 | 免费 | **0元/月** |
| 宝塔 + Oracle | 免费 | 免费 | 免费 | **0元/月** |
| Railway + Vercel | 免费额度 | 免费额度 | 免费 | **0元/月** |

## 🎯 推荐方案

### 对于初学者：Railway + Vercel
- ✅ 最简单
- ✅ 无需服务器管理
- ✅ 自动部署
- ✅ 完全免费

### 对于有经验者：Docker + Oracle
- ✅ 完全控制
- ✅ 性能最好
- ✅ 永久免费
- ✅ 学习价值高

## 🚀 快速开始

### 选择Railway方案（推荐新手）
1. 注册Railway账号
2. 连接GitHub仓库
3. 部署后端和数据库
4. 使用Vercel部署前端
5. **预计30分钟完成**

### 选择Docker方案（推荐有经验者）
1. 申请Oracle Cloud免费服务器
2. 安装Docker环境
3. 部署后端和数据库
4. 使用Vercel部署前端
5. **预计2小时完成**

## 🆘 技术支持

如果在部署过程中遇到问题：
1. 查看官方文档
2. 在GitHub Issues中提问
3. 寻求社区帮助

---

**现在就开始吧！选择最适合您的方案开始免费部署！** 🚀
